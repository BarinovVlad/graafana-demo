{
  "folderUid": "general",
  "uid": "b417f9c5-da7c-44d9-b4b3-89511e1306c8",
  "name": "VM Overview",
  "kind": 1,
  "type": "table",
  "description": "",
  "model": {
    "datasource": {
      "type": "prometheus"
    },
    "description": "",
    "fieldConfig": {
      "defaults": {
        "color": {
          "mode": "thresholds"
        },
        "custom": {
          "align": "right",
          "cellOptions": {
            "type": "auto"
          },
          "inspect": false,
          "minWidth": 0
        },
        "mappings": [],
        "thresholds": {
          "mode": "absolute",
          "steps": [
            {
              "color": "green",
              "value": null
            },
            {
              "color": "red",
              "value": 80
            }
          ]
        }
      },
      "overrides": [
        {
          "matcher": {
            "id": "byName",
            "options": "Uptime"
          },
          "properties": [
            {
              "id": "unit",
              "value": "s"
            },
            {
              "id": "custom.cellOptions",
              "value": {
                "type": "color-background"
              }
            },
            {
              "id": "thresholds",
              "value": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "red",
                    "value": null
                  },
                  {
                    "color": "orange",
                    "value": 172800
                  },
                  {
                    "color": "green",
                    "value": 259200
                  }
                ]
              }
            }
          ]
        },
        {
          "matcher": {
            "id": "byName",
            "options": "Memory"
          },
          "properties": [
            {
              "id": "unit",
              "value": "decbytes"
            },
            {
              "id": "decimals",
              "value": 2
            }
          ]
        },
        {
          "matcher": {
            "id": "byName",
            "options": "Load [5m]"
          },
          "properties": [
            {
              "id": "decimals",
              "value": 2
            },
            {
              "id": "thresholds",
              "value": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "#EAB839",
                    "value": 4
                  },
                  {
                    "color": "orange",
                    "value": 15
                  },
                  {
                    "color": "red",
                    "value": 30
                  }
                ]
              }
            },
            {
              "id": "custom.cellOptions",
              "value": {
                "type": "color-background"
              }
            }
          ]
        },
        {
          "matcher": {
            "id": "byName",
            "options": "Metrics"
          },
          "properties": [
            {
              "id": "unit",
              "value": "bool_on_off"
            },
            {
              "id": "custom.cellOptions",
              "value": {
                "type": "color-background"
              }
            },
            {
              "id": "thresholds",
              "value": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "red",
                    "value": null
                  },
                  {
                    "color": "green",
                    "value": 1
                  }
                ]
              }
            },
            {
              "id": "custom.width",
              "value": 69
            }
          ]
        },
        {
          "matcher": {
            "id": "byName",
            "options": "Availability"
          },
          "properties": [
            {
              "id": "custom.cellOptions",
              "value": {
                "type": "color-background"
              }
            },
            {
              "id": "unit",
              "value": "percentunit"
            },
            {
              "id": "thresholds",
              "value": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "red",
                    "value": null
                  },
                  {
                    "color": "orange",
                    "value": 0.95
                  },
                  {
                    "color": "yellow",
                    "value": 0.99
                  },
                  {
                    "color": "green",
                    "value": 1
                  }
                ]
              }
            },
            {
              "id": "decimals",
              "value": 3
            }
          ]
        },
        {
          "matcher": {
            "id": "byName",
            "options": "Critical"
          },
          "properties": [
            {
              "id": "custom.cellOptions",
              "value": {
                "type": "color-background",
                "wrapText": false
              }
            },
            {
              "id": "thresholds",
              "value": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "yellow",
                    "value": 70
                  },
                  {
                    "color": "orange",
                    "value": 80
                  },
                  {
                    "color": "red",
                    "value": 90
                  }
                ]
              }
            },
            {
              "id": "custom.width",
              "value": 71
            }
          ]
        },
        {
          "matcher": {
            "id": "byName",
            "options": "Important"
          },
          "properties": [
            {
              "id": "custom.cellOptions",
              "value": {
                "type": "color-background"
              }
            },
            {
              "id": "thresholds",
              "value": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "orange",
                    "value": 1
                  }
                ]
              }
            },
            {
              "id": "custom.width",
              "value": 71
            }
          ]
        },
        {
          "matcher": {
            "id": "byName",
            "options": "Moderate"
          },
          "properties": [
            {
              "id": "custom.cellOptions",
              "value": {
                "type": "color-background"
              }
            },
            {
              "id": "thresholds",
              "value": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "yellow",
                    "value": 1
                  }
                ]
              }
            }
          ]
        },
        {
          "matcher": {
            "id": "byName",
            "options": "Hostname"
          },
          "properties": [
            {
              "id": "custom.width",
              "value": 256
            }
          ]
        },
        {
          "matcher": {
            "id": "byName",
            "options": "Kernel"
          },
          "properties": [
            {
              "id": "custom.width",
              "value": 229
            }
          ]
        },
        {
          "matcher": {
            "id": "byName",
            "options": "CPU usage"
          },
          "properties": [
            {
              "id": "unit",
              "value": "percent"
            },
            {
              "id": "custom.cellOptions",
              "value": {
                "type": "color-background"
              }
            }
          ]
        },
        {
          "matcher": {
            "id": "byName",
            "options": "Memory usage"
          },
          "properties": [
            {
              "id": "unit",
              "value": "percent"
            },
            {
              "id": "custom.cellOptions",
              "value": {
                "type": "color-background"
              }
            }
          ]
        },
        {
          "matcher": {
            "id": "byName",
            "options": "Max disk usage"
          },
          "properties": [
            {
              "id": "custom.cellOptions",
              "value": {
                "type": "color-background"
              }
            },
            {
              "id": "unit",
              "value": "percent"
            }
          ]
        },
        {
          "matcher": {
            "id": "byName",
            "options": "CPU"
          },
          "properties": [
            {
              "id": "custom.width",
              "value": 41
            }
          ]
        }
      ]
    },
    "gridPos": {
      "h": 8,
      "w": 24,
      "x": 0,
      "y": 1
    },
    "id": 198,
    "interval": "5m",
    "options": {
      "cellHeight": "sm",
      "footer": {
        "countRows": false,
        "fields": "",
        "reducer": [
          "sum"
        ],
        "show": false
      },
      "showHeader": true,
      "sortBy": []
    },
    "pluginVersion": "12.0.2",
    "targets": [
      {
        "datasource": {
          "type": "prometheus"
        },
        "editorMode": "code",
        "exemplar": false,
        "expr": "  (node_uname_info{instanceName=\"$qmsInstanceName\"} OR label_replace(windows_os_hostname{instanceName=\"$qmsInstanceName\"},\"nodename\", \"$1\", \"hostname\", \"(.*)\"\n)) - 0\n  \n",
        "format": "table",
        "hide": false,
        "instant": true,
        "legendFormat": "__auto",
        "range": false,
        "refId": "Node Info"
      },
      {
        "datasource": {
          "type": "prometheus"
        },
        "editorMode": "code",
        "exemplar": false,
        "expr": "sum(time() - node_boot_time_seconds{instanceName=\"$qmsInstanceName\"}) by (instance)",
        "format": "table",
        "hide": false,
        "instant": true,
        "legendFormat": "__auto",
        "range": false,
        "refId": "Uptime"
      },
      {
        "datasource": {
          "type": "prometheus"
        },
        "editorMode": "code",
        "exemplar": false,
        "expr": "node_memory_MemTotal_bytes{instanceName=\"$qmsInstanceName\"} - 0",
        "format": "table",
        "hide": false,
        "instant": true,
        "legendFormat": "__auto",
        "range": false,
        "refId": "TotalMem"
      },
      {
        "datasource": {
          "type": "prometheus"
        },
        "editorMode": "code",
        "exemplar": false,
        "expr": "count(node_cpu_seconds_total{instanceName=\"$qmsInstanceName\", mode=\"system\"}) by (instance)",
        "format": "table",
        "hide": false,
        "instant": true,
        "legendFormat": "__auto",
        "range": false,
        "refId": "TotalCPU"
      },
      {
        "datasource": {
          "type": "prometheus"
        },
        "editorMode": "code",
        "exemplar": false,
        "expr": "sum (up{instanceName=\"$qmsInstanceName\", job=~\".*vm\"}) by (instance, job)",
        "format": "table",
        "hide": false,
        "instant": true,
        "legendFormat": "__auto",
        "range": false,
        "refId": "Metrics OK"
      },
      {
        "datasource": {
          "type": "prometheus"
        },
        "editorMode": "code",
        "exemplar": false,
        "expr": "avg (avg_over_time(up{instanceName=\"$qmsInstanceName\", job=~\".*vm\"}[$__range])) by (instance)",
        "format": "table",
        "hide": false,
        "instant": true,
        "legendFormat": "__auto",
        "range": false,
        "refId": "Metrics Availability"
      },
      {
        "datasource": {
          "type": "prometheus"
        },
        "editorMode": "code",
        "exemplar": false,
        "expr": "sum by (nodename) (\n    label_replace(\n        hms_dnf{instanceName=\"$qmsInstanceName\", type=\"Critical\"}, \"serverName\", \"$1\", \"instance\", \"^([^.]+)\\\\..+\"\n    )\n    * on(serverName)\n    group_left(nodename)\n    label_replace(\n        node_uname_info{instanceName=\"$qmsInstanceName\"}, \"serverName\", \"$1\", \"instance\", \"^([^.]+)\\\\..+\"\n    )\n)",
        "format": "table",
        "hide": false,
        "instant": true,
        "legendFormat": "__auto",
        "range": false,
        "refId": "RHEL Updates Critical"
      },
      {
        "datasource": {
          "type": "prometheus"
        },
        "editorMode": "code",
        "exemplar": false,
        "expr": "sum by (nodename) (\n    label_replace(\n        hms_dnf{instanceName=\"$qmsInstanceName\", type=\"Important\"}, \"serverName\", \"$1\", \"instance\", \"^([^.]+)\\\\..+\"\n    )\n    * on(serverName)\n    group_left(nodename)\n    label_replace(\n        node_uname_info{instanceName=\"$qmsInstanceName\"}, \"serverName\", \"$1\", \"instance\", \"^([^.]+)\\\\..+\"\n    )\n)",
        "format": "table",
        "hide": false,
        "instant": true,
        "legendFormat": "__auto",
        "range": false,
        "refId": "RHEL Updates Important"
      },
      {
        "datasource": {
          "type": "prometheus"
        },
        "editorMode": "code",
        "exemplar": false,
        "expr": "sum by (nodename) (\n    label_replace(\n        hms_dnf{instanceName=\"$qmsInstanceName\", type=\"Moderate\"}, \"serverName\", \"$1\", \"instance\", \"^([^.]+)\\\\..+\"\n    )\n    * on(serverName)\n    group_left(nodename)\n    label_replace(\n        node_uname_info{instanceName=\"$qmsInstanceName\"}, \"serverName\", \"$1\", \"instance\", \"^([^.]+)\\\\..+\"\n    )\n)",
        "format": "table",
        "hide": false,
        "instant": true,
        "legendFormat": "__auto",
        "range": false,
        "refId": "RHEL Updates Moderate"
      },
      {
        "datasource": {
          "type": "prometheus"
        },
        "editorMode": "code",
        "exemplar": false,
        "expr": "node_load5{instanceName=\"$qmsInstanceName\"}",
        "format": "table",
        "hide": false,
        "instant": true,
        "legendFormat": "__auto",
        "range": false,
        "refId": "Load"
      },
      {
        "datasource": {
          "type": "prometheus"
        },
        "editorMode": "code",
        "exemplar": false,
        "expr": "(1 - avg(rate(node_cpu_seconds_total{instanceName=\"$qmsInstanceName\",mode=\"idle\"}[$__interval])) by (instance)) * 100",
        "format": "table",
        "hide": false,
        "instant": true,
        "legendFormat": "__auto",
        "range": false,
        "refId": "CPU Usage"
      },
      {
        "datasource": {
          "type": "prometheus"
        },
        "editorMode": "code",
        "exemplar": false,
        "expr": "(1 - (node_memory_MemAvailable_bytes{instanceName=\"$qmsInstanceName\"} / node_memory_MemTotal_bytes{instanceName=\"$qmsInstanceName\"})) * 100",
        "format": "table",
        "hide": false,
        "instant": true,
        "legendFormat": "__auto",
        "range": false,
        "refId": "Memory Usage"
      },
      {
        "datasource": {
          "type": "prometheus"
        },
        "editorMode": "code",
        "exemplar": false,
        "expr": "max((node_filesystem_size_bytes{instanceName=\"$qmsInstanceName\",fstype=~\"ext.?|xfs\",mountpoint!~\"/boot|/tmp\"}-node_filesystem_free_bytes{instanceName=\"$qmsInstanceName\",fstype=~\"ext.?|xfs\",mountpoint!~\"/boot|/tmp\"}) *100/(node_filesystem_avail_bytes {instanceName=\"$qmsInstanceName\",fstype=~\"ext.?|xfs\",mountpoint!~\"/boot|/tmp\"}+(node_filesystem_size_bytes{instanceName=\"$qmsInstanceName\",fstype=~\"ext.?|xfs\",mountpoint!~\"/boot|/tmp\"}-node_filesystem_free_bytes{instanceName=\"$qmsInstanceName\",fstype=~\"ext.?|xfs\",mountpoint!~\"/boot|/tmp\"})))by(instance)",
        "format": "table",
        "hide": false,
        "instant": true,
        "legendFormat": "__auto",
        "range": false,
        "refId": "Max disk usage"
      }
    ],
    "title": "Linux VM Overview",
    "transformations": [
      {
        "id": "merge",
        "options": {}
      },
      {
        "id": "organize",
        "options": {
          "excludeByName": {
            "Time": true,
            "Value #A": false,
            "Value #Node Info": true,
            "__name__": true,
            "customerName": true,
            "development": true,
            "domainname": true,
            "environment": true,
            "fqdn": true,
            "hostname": true,
            "instance": true,
            "instanceName": true,
            "issueKey": true,
            "job": true,
            "machine": true,
            "projectName": true,
            "receive": true,
            "serverName": true,
            "sysname": true,
            "tenant_id": true,
            "type": true,
            "version": true
          },
          "includeByName": {},
          "indexByName": {
            "Time": 14,
            "Value #CPU Usage": 5,
            "Value #Load": 10,
            "Value #Max disk usage": 7,
            "Value #Memory Usage": 6,
            "Value #Metrics Availability": 9,
            "Value #Metrics OK": 8,
            "Value #Node Info": 28,
            "Value #RHEL Updates Critical": 11,
            "Value #RHEL Updates Important": 12,
            "Value #RHEL Updates Moderate": 13,
            "Value #TotalCPU": 2,
            "Value #TotalMem": 3,
            "Value #Uptime": 4,
            "__name__": 29,
            "customerName": 15,
            "development": 16,
            "domainname": 17,
            "environment": 18,
            "instance": 19,
            "instanceName": 20,
            "issueKey": 21,
            "job": 22,
            "machine": 23,
            "nodename": 0,
            "receive": 24,
            "release": 1,
            "sysname": 25,
            "tenant_id": 26,
            "version": 27
          },
          "renameByName": {
            "Value #A": "Load [5m]",
            "Value #B": "Uptime",
            "Value #C": "Load (5m)",
            "Value #CPU Usage": "CPU usage",
            "Value #Disk Read": "Disk read",
            "Value #Disk Write": "Disk write",
            "Value #Load": "Load [5m]",
            "Value #Max disk usage": "Max disk usage",
            "Value #Memory Usage": "Memory usage",
            "Value #Metrics Availability": "Availability",
            "Value #Metrics OK": "Metrics",
            "Value #Metrics availability": "Metrics",
            "Value #RHEL Updates Critical": "Critical",
            "Value #RHEL Updates Important": "Important",
            "Value #RHEL Updates Moderate": "Moderate",
            "Value #Received": "Net receive",
            "Value #TotalCPU": "CPU",
            "Value #TotalMem": "Memory",
            "Value #Transmitted": "Net transmitted",
            "Value #Uptime": "Uptime",
            "nodename": "Hostname",
            "release": "Kernel"
          }
        }
      }
    ],
    "type": "table"
  }
}